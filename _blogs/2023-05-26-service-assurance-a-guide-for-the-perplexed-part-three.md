---
published: false
date: '2023-05-26 13:01 -0600'
title: 'Service Assurance: A Guide For The Perplexed, Part Three'
---
Place In Network  
Customer Edge. If the SP is managing the CE device, then the SP has the option to deploy probes at the customer premise to monitor a specific service.  This has the advantage of assuring the full end-to-end path. With this kind of visibility, an SP could provide a dashboard view of the performance of a particular service that a customer bought. For this to work, CE probes have to be orchestrated, managed, monitored and visualized for each customer site which can be a challenge at scale.  
 
Provider Edge: If the SP is not managing the CE device or does not want to deal with the scale issues of CE-based probing, probes can be exchanged between PE routers.  This has the advantage of having fewer probe generators to manage but it does lack the full end-to-end insight of a CE to CE probe.

Service-Specific Probes
L3VPN services can be validated with the Cisco IP SLA feature which includes partial support for the IETF-standardized Two-Way Active Measurement Protocol (TWAMP).  IP SLA allows the router to inject synthetic traffic in the end customer’s specific VRF with a specific DSCP, so the probe traffic receives exactly the same treatment as the end customer’s traffic.  IP SLA can measure loss, delay and jitter in one or both directions.  In the future, the IOS XR Performance Measurement feature will be extended to support full TWAMP, IPv6, YANG data models and ECMP.

L2VPNs can be assessed with the mechanisms defined in the IETF Y.1731 standard, which is supported by the Ethernet CFM feature set in IOS XR.  Y.1731 supports one and two-way loss, delay and jitter measurements at Layer 2.  Virtual Circuit Connectivity Verification (VCCV), defined in RFC 5085) and BFD over VCCV (RFC 5885) can be used for rapid liveness detection of the MPLS portion of the L2VPN.  However, it’s important to note that not all L2VPN services support Y.1731 today.  For example, Y.1731 is only supported on single-homed EVPN VPWS services, not multi-homed or ELAN services.

Third-party external probe systems typically support TWAMP and Y.1731 as well as Y.1564 and a host of higher-level probes for TCP, UDP, VoIP, Video, HTTP(S), DNS, etc.

Transport Probes
There are other embedded probes that do not directly measure service performance but are sometimes used as a proxy when other measurements are not available.  For example, Performance Measurement (PM) can measure the characteristics of an end-to-end Segment Routing or RSVP Traffic Engineering Policy.   If the service is using a TE policy, then PM can give a view of the aggregate performance of the MPLS portion of all services in that policy.  Note that this is a proxy measurement at best. Probing the transport path is not a direct measurement of the service performance: it measures the performance of a shared path that goes between the internally facing PE interfaces.  For non-TE traffic, the MPLS LSP monitor feature can monitor connectivity to the BGP next-hop addresses in a VRF.  BFD, ping, and traceroute can also be used to measure the liveness of the path.  
Probing paths is inherently more scalable than probing services since many thousands of services might share the same path.  However, relying on path probe data opens a new challenge: how to associate a service with a path (or paths).  A service might be configured to use a TE path but have fallen back to the shortest path because the TE path failed. The only way to know this would be to verify the real time operational state of the service.  In the case of SR-TE, different prefixes in a single service could be assigned a different policy, resulting in multiple paths to the same destination.  Under these conditions, maintaining a real time mapping of services to paths represents a non-trivial amount of work for a management application. 
Given the scale and complexity issues, some Service Providers don’t bother with the subtleties of true per-service assurance.  Instead, generic path monitoring metrics from ingress PE to egress PE are reported to the end customer as fulfillment of the SLA.  If all services use the shortest path between two PEs and the variations associated with ECMP paths can be ignored, then this might be “good enough.”  But as end customers get better at measuring the precise performance of their services and/or Service Providers try to offer differentiated services, then these kinds of approximations will no longer suffice.

While sending synthetic traffic to probe the service data path gives an accurate measurement of the service quality, it can be computationally expensive to generate, timestamp, send, receive and analyze the probe packets.  This becomes a significant issue when the number of services begins to scale, especially for embedded router probes which are more resource constrained than external third-party probes.

Multipoint Service Scale
Multipoint services include L3VPNs and ELAN L2VPN services.  To assure the multipoint services, you would need to measure the SLA of every possible connection in that service.  For example, take an L3VPN service. The number of required probes would be equal to the number of connections in the VRF which, for a fully meshed network, is calculated according to the formula (n*(n-1))/2.   If you have a small Enterprise L3VPN service with 5 customer sites, then that’s 10 probes for that service alone. 
But it’s actually worse than that.  Most L3VPN services are sold with multiple classes of service.  So if the customer paid for 25% Gold, 25% Silver and 50% Best Effort traffic, then you’d need a probe for each Class of Service.  So now you’re up to 3 * 10 = 30 probes for one small service.   Compare that to the number of probe packets that IOS XR platforms can actually support.  The NCS platforms support a total of 2000 probes, so clearly that won’t scale.  Purpose built premium edge platforms like the ASR9000 can do many more probes (e.g. 60,000 on the RP with more on the line cards) but even then, you will bump up against probe packet processing limits when deploying tens of thousands of services on a large edge platform. 
You can mitigate some of these scale issues by leveraging some of the design principles discussed earlier.  For example, you could offload L3VPN probe generation to shadow routers or third-party probes.  For a managed service, you could offload probes to the CE device.   Or you could measure the transport path performance using Performance Measure (PM) for TE paths and MPLS LSP monitoring for BGP next-hops and use the aggregate measurement as a “best guess” for multiple services along those paths. 

Alternatively, some Service Providers tackle the scale problem by deploying service probes selectively.  Probes are expensive, so Service Providers can design their service offerings accordingly.  If an L3VPN service is going to include premium SLAs that can only be measured by expensive probes, then that expense can and should be included in the prices of the premium service.  In the end, perhaps only a fraction of the L3VPN services offered by a Provider would need regularly monitored SLAs.  Another option would be to probe all services but do it infrequently, e.g. at service activation time and for troubleshooting.

Point to Point Service Assurance Scale
The majority of L2VPN services are pseudowires with exactly two endpoints.   Instead of the n^2scale problem of multipoint L3VPNS, pseudowires have a single connection that needs to be monitored.  However, in the absence of newer hardware offload features, the number of CFM sessions and probes can be limited depending on the platform.
